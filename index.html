<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#111827" />
  <title>Mis Herramientas</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --primary: #2563eb;
      --accent: #16a34a;
      --danger: #ef4444;
      --border: #e5e7eb;
      --ring: rgba(37, 99, 235, 0.2);
      --accent-bg: rgba(22, 163, 74, 0.1);
      --accent-border: rgba(22, 163, 74, 0.3);
      --radius: 14px;
      --shadow: 0 1px 2px rgba(0,0,0,0.04);
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1220;
        --card: #0e1628;
        --text: #e5e7eb;
        --muted: #9aa4b2;
        --border: #182033;
        --shadow: 0 1px 2px rgba(0,0,0,0.5);
        --ring: rgba(59,130,246,0.25);
        --accent-bg: rgba(22, 163, 74, 0.15);
        --accent-border: rgba(22, 163, 74, 0.4);
      }
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
      padding: 24px;
    }

    /* Contenedor principal para centrar todo */
    .wrapper {
      max-width: 640px;
      margin: 0 auto;
      display: grid;
      gap: 24px;
    }

    .card {
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 22px 20px;
    }
    .header {
      display: flex; align-items: baseline; justify-content: space-between; gap: 8px; margin-bottom: 8px;
    }
    .title {
      font-weight: 700; letter-spacing: -0.02em;
      font-size: clamp(18px, 2.2vw, 22px);
    }
    .subtle { color: var(--muted); font-size: 12px; }
    .form { display: grid; gap: 18px; margin-top: 10px; }
    .field { display: grid; gap: 8px; }
    .field-head {
      display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap;
    }
    label { color: var(--muted); font-size: 14px; font-weight: 500; }
    .control { position: relative; display: flex; align-items: center; }
    input[type="text"], input[type="number"] {
      width: 100%; padding: 14px 14px;
      border: 1px solid var(--border); background: transparent;
      border-radius: 12px; color: var(--text);
      font-size: 16px; line-height: 1; outline: none;
      transition: border-color .18s ease, box-shadow .18s ease;
    }
    input::placeholder { color: #9aa3af80; }
    input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px var(--ring); }
    .suffix {
      position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
      font-size: 12px; color: var(--muted); pointer-events: none;
      padding: 4px 8px; border-radius: 8px; background: transparent; border: 1px solid var(--border);
    }
    .note { font-size: 12px; color: var(--muted); }
    .invalid input { border-color: var(--danger); }
    .invalid input:focus { box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2); }

    .btn {
      appearance: none; cursor: pointer; border-radius: 10px; line-height: 1; display: inline-flex; align-items: center; gap: 8px;
      font-size: 13px; padding: 10px 12px; border: 1px solid var(--border); background: transparent; color: var(--text);
      transition: background .18s ease, border-color .18s ease, transform .05s ease;
      text-decoration: none;
    }
    .btn:hover { background: rgba(148,163,184,0.08); }
    .btn:active { transform: translateY(1px); }
    .btn.primary { border-color: rgba(37,99,235,0.35); background: rgba(37,99,235,0.08); color: var(--text); }
    .btn.link { color: var(--primary); border-color: rgba(37,99,235,0.25); }
    .btn.sm { padding: 8px 10px; font-size: 12px; border-radius: 8px; }

    .result {
      margin-top: 6px; padding: 16px;
      border: 1px solid var(--border); border-radius: 12px;
      display: grid; gap: 6px; background: transparent;
    }
    .result .label { font-size: 12px; color: var(--muted); }
    .result .value {
      font-weight: 800; letter-spacing: -0.02em;
      font-size: clamp(26px, 4.5vw, 34px); color: var(--accent);
    }
    .meta { font-size: 13px; color: var(--muted); }
    .actions { display: flex; gap: 8px; margin-top: 2px; flex-wrap: wrap; }

    /* --- COMPARADOR DE PRODUCTOS --- */
    .productos { display: grid; gap: 16px; }
    .producto {
      background: transparent;
      padding: 18px;
      border-radius: 12px;
      border: 1px solid var(--border);
      transition: all 0.25s ease;
    }
    .producto.mejor {
      background: var(--accent-bg);
      border-color: var(--accent-border);
      border-width: 2px;
    }
    .producto h3 {
      color: var(--text);
      margin-bottom: 12px;
      font-size: 16px;
      font-weight: 600;
    }
    .input-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }
    .resultado-comparador {
      background: transparent;
      padding: 14px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid var(--border);
    }
    .precio-unidad {
      font-size: 22px;
      font-weight: 700;
      color: var(--text);
      letter-spacing: -0.01em;
    }
    .unidad-texto {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }
    .mejor .resultado-comparador {
      background: var(--accent-bg);
      border-color: var(--accent);
      border-width: 2px;
    }
    .mejor .precio-unidad {
      color: var(--accent);
    }
    .badge {
      display: inline-block;
      background: var(--accent);
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      margin-top: 8px;
    }

    .divider {
      height: 1px;
      background: var(--border);
      margin: 30px 0;
    }

    .footer { margin-top: 12px; text-align: center; font-size: 12px; color: var(--muted); }

    @media (max-width: 500px) {
      .input-group { grid-template-columns: 1fr; }
    }
    @media (prefers-reduced-motion: reduce) { * { transition: none !important; } }
  </style>
</head>
<body>
  <div class="wrapper">
    
    <!-- ==================== CALCULADORA DE SOLES ==================== -->
    <main class="card" role="main">
      <div class="header">
        <div class="title">üí± Calculadora de Soles</div>
        <div class="subtle" id="bcvUpdated">‚Äî</div>
      </div>

      <form class="form" autocomplete="off" onsubmit="return false">
        <div class="field" id="wrap-bcv">
          <div class="field-head">
            <label for="bcvRate">Tasa BCV (USD/VES)</label>
            <div style="display:inline-flex; gap:8px; flex-wrap:wrap;">
              <button id="fetchBCVBtn" type="button" class="btn sm primary" title="Obtener autom√°ticamente desde el BCV">‚ü≥ Actualizar</button>
              <a id="bcvLink" class="btn sm link" href="https://www.bcv.org.ve/glosario/cambio-oficial" target="_blank" rel="noopener noreferrer" title="Abrir sitio del BCV (nueva pesta√±a)">Ver BCV ‚Üó</a>
            </div>
          </div>
          <div class="control">
            <input id="bcvRate" type="text" inputmode="decimal" placeholder="Ej: 231.04620000" aria-describedby="bcvNote" spellcheck="false" />
            <span class="suffix">USD ‚Üí VES</span>
          </div>
          <div id="bcvNote" class="note">Se obtiene autom√°ticamente. Puedes editarla.</div>
        </div>

        <div class="field" id="wrap-company">
          <label for="companyRate">Tasa de la empresa (VES/PEN)</label>
          <div class="control">
            <input id="companyRate" type="text" inputmode="decimal" placeholder="Ej: 0.00002010" aria-describedby="companyNote" spellcheck="false" />
            <span class="suffix">VES ‚Üí PEN</span>
          </div>
          <div id="companyNote" class="note">Bol√≠vares por 1 sol.</div>
        </div>

        <div class="field" id="wrap-usd">
          <label for="usdAmount">Monto a enviar (USD)</label>
          <div class="control">
            <input id="usdAmount" type="text" inputmode="decimal" placeholder="Ej: 500" aria-describedby="usdNote" spellcheck="false" />
            <span class="suffix">USD</span>
          </div>
          <div id="usdNote" class="note">Cantidad de USD a transferir.</div>
        </div>
      </form>

      <section class="result" aria-live="polite">
        <div class="label">Monto en soles a transferir</div>
        <div class="value" id="resultValue">‚Äî</div>
        <div class="meta" id="implicitRate">(Tasa impl√≠cita: 1 USD = ‚Äî PEN)</div>
        <div class="actions">
          <button class="btn primary" id="copyBtn" type="button">Copiar resultado</button>
          <button class="btn" id="resetBtn" type="button">Limpiar</button>
        </div>
      </section>
    </main>

    <!-- ==================== COMPARADOR DE PRODUCTOS ==================== -->
    <section class="card">
      <div class="header">
        <div class="title">üõí Comparador de Productos</div>
      </div>
      <p class="note" style="margin-bottom: 16px;">Descubre cu√°l producto tiene mejor precio por gramo</p>

      <div class="productos">
        <!-- Producto 1 -->
        <div class="producto" id="producto1">
          <h3>Producto 1</h3>
          <div class="input-group">
            <div class="field">
              <label for="cantidad1">Cantidad</label>
              <input type="number" id="cantidad1" placeholder="250" value="250" min="0" step="any">
            </div>
            <div class="field">
              <label for="precio1">Precio (S/)</label>
              <input type="number" id="precio1" placeholder="10" value="10" min="0" step="0.01">
            </div>
          </div>
          <div class="resultado-comparador">
            <div class="precio-unidad" id="resultado1">S/ 0.00</div>
            <div class="unidad-texto">por gramo</div>
          </div>
        </div>

        <!-- Producto 2 -->
        <div class="producto" id="producto2">
          <h3>Producto 2</h3>
          <div class="input-group">
            <div class="field">
              <label for="cantidad2">Cantidad</label>
              <input type="number" id="cantidad2" placeholder="500" value="500" min="0" step="any">
            </div>
            <div class="field">
              <label for="precio2">Precio (S/)</label>
              <input type="number" id="precio2" placeholder="60" value="60" min="0" step="0.01">
            </div>
          </div>
          <div class="resultado-comparador">
            <div class="precio-unidad" id="resultado2">S/ 0.00</div>
            <div class="unidad-texto">por gramo</div>
          </div>
        </div>
      </div>
    </section>

    <p class="footer">Tus datos se guardan localmente. Dark mode autom√°tico.</p>
  </div>

  <script>
    // ==================== CALCULADORA DE SOLES ====================
    const RACE_URLS = [
      'https://r.jina.ai/https://www.bcv.org.ve/glosario/cambio-oficial',
      'https://r.jina.ai/http://www.bcv.org.ve/glosario/cambio-oficial',
    ];
    const FETCH_TIMEOUT_MS = 7000;

    const fmtPEN = new Intl.NumberFormat('es-PE', { style: 'currency', currency: 'PEN', maximumFractionDigits: 2 });
    const fmt6   = new Intl.NumberFormat('es-PE', { minimumFractionDigits: 2, maximumFractionDigits: 6 });

    function parseLocaleNumber(value) {
      if (typeof value === 'number') return value;
      const s = (value || '').toString().trim();
      if (!s) return NaN;
      const hasComma = s.includes(',');
      const hasDot   = s.includes('.');
      let dec = '.';
      if (hasComma && hasDot) dec = s.lastIndexOf(',') > s.lastIndexOf('.') ? ',' : '.';
      else if (hasComma) dec = ',';
      const re = new RegExp('[^0-9\\' + dec + '\\-]', 'g');
      const cleaned = s.replace(re, '');
      const parts = cleaned.split(dec);
      if (parts.length === 1) return parseFloat(parts[0].replace(/[^\d\-]/g, ''));
      const integer = parts.slice(0, -1).join('').replace(/[^\d\-]/g, '');
      const decimal = parts[parts.length - 1].replace(/\D/g, '');
      const n = parseFloat(integer + '.' + decimal);
      return Number.isFinite(n) ? n : NaN;
    }
    const decimalsIn = (token) => {
      const m = (token || '').toString().match(/[.,](\d+)/);
      return m ? m[1].length : 0;
    };
    const isPlausibleRate = (val, decs) => val > 0.01 && val < 5000 && decs >= 2;

    function formatRate(n) {
      const num = Number(n);
      if (!Number.isFinite(num) || num <= 0) return '';
      return num.toFixed(8);
    }

    function detectBCVFromDOM(html) {
      try {
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const rows = doc.querySelectorAll('.row.recuadrotsmc, .recuadrotsmc');
        for (const row of rows) {
          if (!/USD/i.test(row.textContent || '')) continue;
          const node = row.querySelector('.centrado strong') || row.querySelector('strong, b');
          if (node && node.textContent) {
            const txt = node.textContent.trim();
            const val = parseLocaleNumber(txt);
            const decs = decimalsIn(txt);
            if (isPlausibleRate(val, decs)) return { value: val, token: txt, source: 'dom' };
          }
        }
        const strong = doc.querySelector('.recuadrotsmc .centrado strong') || doc.querySelector('.recuadrotsmc strong');
        if (strong) {
          const txt = strong.textContent.trim();
          const val = parseLocaleNumber(txt);
          const decs = decimalsIn(txt);
          if (isPlausibleRate(val, decs)) return { value: val, token: txt, source: 'dom-fallback' };
        }
      } catch {}
      return null;
    }

    function detectBCVFromText(text) {
      if (!text) return null;
      const norm = text.replace(/\u00A0/g, ' ').replace(/\s+/g, ' ');
      let m = /USD[\s\S]{0,120}?((?:\d{1,3}(?:[.\s]\d{3})+|\d+)(?:[.,]\d{2,8}))/i.exec(norm);
      if (m) {
        const val = parseLocaleNumber(m[1]); const decs = decimalsIn(m[1]);
        if (isPlausibleRate(val, decs)) return { value: val, token: m[1], source: 'text-window' };
      }
      m = /1\s*(?:USD|\$)\s*=\s*((?:\d{1,3}(?:[.\s]\d{3})+|\d+)(?:[.,]\d{2,8}))/i.exec(norm);
      if (m) {
        const val = parseLocaleNumber(m[1]); const decs = decimalsIn(m[1]);
        if (isPlausibleRate(val, decs)) return { value: val, token: m[1], source: 'text-equals' };
      }
      const rxNum = /(?:(?:\d{1,3}(?:[.,\s]\d{3})+)|\d+)(?:[.,]\d+)?/g;
      const kws = ['usd','bcv','cambio','oficial','ves','bs'];
      const candidates = [];
      let match;
      while ((match = rxNum.exec(norm)) !== null) {
        const token = match[0]; const idx = match.index;
        const val = parseLocaleNumber(token); const decs = decimalsIn(token);
        if (!Number.isFinite(val)) continue;
        const ctx = norm.slice(Math.max(0, idx - 60), Math.min(norm.length, idx + token.length + 60)).toLowerCase();
        let kwScore = 0; for (const k of kws) if (ctx.includes(k)) kwScore++;
        let score = 0;
        if (isPlausibleRate(val, decs)) score += 5;
        if (decs >= 4) score += 2;
        score += Math.min(kwScore, 3);
        candidates.push({ value: val, token, score });
      }
      candidates.sort((a,b)=>b.score-a.score);
      if (candidates[0] && candidates[0].score >= 5) return { value: candidates[0].value, token: candidates[0].token, source: 'text-general' };
      return null;
    }

    function detectBCV(text) {
      return detectBCVFromDOM(text) || detectBCVFromText(text);
    }

    const el = {
      bcv: document.getElementById('bcvRate'),
      company: document.getElementById('companyRate'),
      usd: document.getElementById('usdAmount'),
      resultValue: document.getElementById('resultValue'),
      implicit: document.getElementById('implicitRate'),
      copy: document.getElementById('copyBtn'),
      reset: document.getElementById('resetBtn'),
      fetch: document.getElementById('fetchBCVBtn'),
      bcvNote: document.getElementById('bcvNote'),
      bcvUpdated: document.getElementById('bcvUpdated'),
      wrap: {
        bcv: document.getElementById('wrap-bcv'),
        company: document.getElementById('wrap-company'),
        usd: document.getElementById('wrap-usd'),
      }
    };
    const originalBcvNote = el.bcvNote.textContent;

    const STORAGE_KEY = 'calc-soles-v1';
    function loadState() { try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); } catch { return {}; } }
    function saveState(extra = {}) {
      const state = { bcv: el.bcv.value, company: el.company.value, usd: el.usd.value, ...extra };
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch {}
    }

    function calculate() {
      const bcv = parseLocaleNumber(el.bcv.value);
      const company = parseLocaleNumber(el.company.value);
      const usd = parseLocaleNumber(el.usd.value);

      [el.wrap.bcv, el.wrap.company, el.wrap.usd].forEach(w => w.classList.remove('invalid'));
      let valid = true;
      if (!(bcv > 0)) { el.wrap.bcv.classList.add('invalid'); valid = false; }
      if (!(company > 0)) { el.wrap.company.classList.add('invalid'); valid = false; }
      if (!(usd >= 0)) { el.wrap.usd.classList.add('invalid'); valid = false; }

      if (!valid) {
        el.resultValue.textContent = '‚Äî';
        el.implicit.textContent = '(Tasa impl√≠cita: 1 USD = ‚Äî PEN)';
        return;
      }

      const implicit = bcv / company;
      const pen = implicit * usd;

      el.resultValue.textContent = isFinite(pen) ? fmtPEN.format(pen) : '‚Äî';
      el.implicit.textContent = `(Tasa impl√≠cita: 1 USD = ${fmt6.format(implicit)} PEN)`;
    }

    async function fetchBCVRate(silent = false) {
      const setLoading = (on) => {
        if (!silent) {
          el.fetch.disabled = on;
          el.fetch.textContent = on ? 'Buscando‚Ä¶' : '‚ü≥ Actualizar';
        }
        el.bcvNote.textContent = on ? 'Obteniendo tasa del BCV‚Ä¶' : originalBcvNote;
      };

      setLoading(true);

      const controllers = RACE_URLS.map(() => new AbortController());
      let resolved = false;

      const attempt = (url, i) => new Promise(async (resolve, reject) => {
        const ctrl = controllers[i];
        const timer = setTimeout(() => ctrl.abort('timeout'), FETCH_TIMEOUT_MS);
        try {
          const res = await fetch(url, {
            method: 'GET',
            mode: 'cors',
            cache: 'no-store',
            redirect: 'follow',
            signal: ctrl.signal,
            headers: { 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' }
          });
          if (!res.ok) return reject(new Error('HTTP ' + res.status));
          const text = await res.text();
          const found = detectBCV(text);
          if (found?.value > 0) return resolve(found);
          return reject(new Error('No se detect√≥ tasa'));
        } catch (e) {
          return reject(e);
        } finally {
          clearTimeout(timer);
        }
      });

      const promises = RACE_URLS.map((u, i) => attempt(u, i).then(found => {
        if (resolved) return;
        resolved = true;
        controllers.forEach((c, j) => { if (j !== i) try { c.abort(); } catch {} });
        return found;
      }));

      let winner = null;
      try {
        winner = await Promise.any(promises);
      } catch {}

      if (winner?.value > 0) {
        el.bcv.value = formatRate(winner.value);
        const now = new Date();
        el.bcvUpdated.textContent = `Actualizado ${now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`;
        el.bcvNote.textContent = 'Tasa actualizada desde BCV';
        setTimeout(() => { el.bcvNote.textContent = originalBcvNote; }, 1600);
        calculate();
        saveState({ fetchedAt: Date.now(), fetchedFrom: 'r.jina.ai', method: winner.source });
        setLoading(false);
        return winner.value;
      } else {
        if (!silent) {
          el.bcvNote.textContent = 'No se pudo obtener autom√°ticamente. Usa "Ver BCV".';
          setTimeout(() => { el.bcvNote.textContent = originalBcvNote; }, 2600);
        }
        setLoading(false);
        return null;
      }
    }

    ['input', 'change'].forEach(ev => {
      el.bcv.addEventListener(ev, () => { calculate(); saveState(); });
      el.company.addEventListener(ev, () => { calculate(); saveState(); });
      el.usd.addEventListener(ev, () => { calculate(); saveState(); });
    });

    el.fetch.addEventListener('click', () => fetchBCVRate(false));

    el.copy.addEventListener('click', async () => {
      const text = `${el.resultValue.textContent} ‚Ä¢ ${el.implicit.textContent.replace(/[()]/g, '')}`;
      try {
        await navigator.clipboard.writeText(text);
        el.copy.textContent = 'Copiado';
        setTimeout(() => el.copy.textContent = 'Copiar resultado', 1400);
      } catch {
        el.copy.textContent = 'No se pudo copiar';
        setTimeout(() => el.copy.textContent = 'Copiar resultado', 1400);
      }
    });

    el.reset.addEventListener('click', () => {
      el.usd.value = '';
      calculate();
    });

    (async function init() {
      const state = loadState();
      if (!state.bcv) state.bcv = '231.04620000';
      el.bcv.value = state.bcv ?? '';
      el.company.value = state.company ?? '';
      el.usd.value = state.usd ?? '';

      if (state.fetchedAt) {
        const t = new Date(state.fetchedAt);
        el.bcvUpdated.textContent = `Actualizado ${t.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`;
      } else {
        el.bcvUpdated.textContent = '‚Äî';
      }

      calculate();
      fetchBCVRate(true);
    })();

    // ==================== COMPARADOR DE PRODUCTOS ====================
    const cantidad1 = document.getElementById('cantidad1');
    const precio1 = document.getElementById('precio1');
    const cantidad2 = document.getElementById('cantidad2');
    const precio2 = document.getElementById('precio2');
    const resultado1 = document.getElementById('resultado1');
    const resultado2 = document.getElementById('resultado2');
    const producto1Div = document.getElementById('producto1');
    const producto2Div = document.getElementById('producto2');

    function calcularYComparar() {
      const cant1 = parseFloat(cantidad1.value) || 0;
      const prec1 = parseFloat(precio1.value) || 0;
      const cant2 = parseFloat(cantidad2.value) || 0;
      const prec2 = parseFloat(precio2.value) || 0;

      const precioUnidad1 = cant1 > 0 ? prec1 / cant1 : 0;
      const precioUnidad2 = cant2 > 0 ? prec2 / cant2 : 0;

      resultado1.textContent = `S/ ${precioUnidad1.toFixed(4)}`;
      resultado2.textContent = `S/ ${precioUnidad2.toFixed(4)}`;

      producto1Div.classList.remove('mejor');
      producto2Div.classList.remove('mejor');

      const badge1 = producto1Div.querySelector('.badge');
      const badge2 = producto2Div.querySelector('.badge');
      if (badge1) badge1.remove();
      if (badge2) badge2.remove();

      if (precioUnidad1 > 0 && precioUnidad2 > 0) {
        if (precioUnidad1 < precioUnidad2) {
          producto1Div.classList.add('mejor');
          const badge = document.createElement('div');
          badge.className = 'badge';
          badge.textContent = '‚úì Mejor opci√≥n';
          producto1Div.querySelector('.resultado-comparador').appendChild(badge);
        } else if (precioUnidad2 < precioUnidad1) {
          producto2Div.classList.add('mejor');
          const badge = document.createElement('div');
          badge.className = 'badge';
          badge.textContent = '‚úì Mejor opci√≥n';
          producto2Div.querySelector('.resultado-comparador').appendChild(badge);
        }
      }
    }

    cantidad1.addEventListener('input', calcularYComparar);
    precio1.addEventListener('input', calcularYComparar);
    cantidad2.addEventListener('input', calcularYComparar);
    precio2.addEventListener('input', calcularYComparar);

    calcularYComparar();
  </script>

  <title>üí™ Gym Tracker Pro</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --primary: #2563eb;
      --accent: #16a34a;
      --danger: #ef4444;
      --warning: #f59e0b;
      --border: #e5e7eb;
      --ring: rgba(37, 99, 235, 0.2);
      --accent-bg: rgba(22, 163, 74, 0.1);
      --radius: 14px;
      --shadow: 0 1px 2px rgba(0,0,0,0.04);
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1220;
        --card: #0e1628;
        --text: #e5e7eb;
        --muted: #9aa4b2;
        --border: #182033;
        --shadow: 0 1px 2px rgba(0,0,0,0.5);
        --ring: rgba(59,130,246,0.25);
        --accent-bg: rgba(22, 163, 74, 0.15);
      }
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      -webkit-font-smoothing: antialiased;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 680px;
      margin: 0 auto;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 16px;
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
    }

    .title {
      font-size: clamp(24px, 4vw, 32px);
      font-weight: 800;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 6px;
    }

    .subtitle {
      color: var(--muted);
      font-size: 14px;
    }

    /* Navegaci√≥n de d√≠as */
    .day-nav {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      overflow-x: auto;
      padding-bottom: 8px;
    }

    .day-btn {
      flex: 1;
      min-width: 80px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 13px;
      font-weight: 600;
      text-align: center;
    }

    .day-btn:hover {
      background: rgba(37, 99, 235, 0.08);
      border-color: var(--primary);
    }

    .day-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .day-btn .day-name {
      display: block;
      font-size: 11px;
      opacity: 0.8;
      margin-top: 2px;
    }

    /* Cron√≥metro */
    .timer-section {
      background: var(--accent-bg);
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
    }

    .timer-label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .timer-display {
      font-size: 48px;
      font-weight: 800;
      color: var(--accent);
      font-variant-numeric: tabular-nums;
      margin-bottom: 16px;
      letter-spacing: -0.02em;
    }

    .timer-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 16px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover {
      background: rgba(148,163,184,0.08);
      transform: translateY(-1px);
    }

    .btn.primary {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .btn.primary:hover {
      background: #15803d;
    }

    .btn.danger {
      background: var(--danger);
      color: white;
      border-color: var(--danger);
    }

    .btn.sm {
      padding: 6px 10px;
      font-size: 12px;
    }

    /* Grupos musculares */
    .muscle-groups {
      display: grid;
      gap: 16px;
    }

    .muscle-group {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      background: transparent;
    }

    .muscle-group-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    .muscle-icon {
      font-size: 24px;
    }

    .muscle-name {
      font-size: 18px;
      font-weight: 700;
      flex: 1;
    }

    .muscle-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 12px;
      background: var(--accent-bg);
      color: var(--accent);
      font-weight: 600;
    }

    /* Ejercicios */
    .exercises {
      display: grid;
      gap: 12px;
    }

    .exercise {
      background: var(--bg);
      padding: 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
    }

    .exercise-name {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 8px;
      color: var(--text);
    }

    .exercise-note {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 10px;
      font-style: italic;
    }

    .series-tracker {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
    }

    .serie-btn {
      padding: 8px;
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      font-size: 12px;
      font-weight: 600;
    }

    .serie-btn:hover {
      border-color: var(--accent);
    }

    .serie-btn.done {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .serie-reps {
      display: block;
      font-size: 16px;
      font-weight: 800;
    }

    .serie-label {
      display: block;
      font-size: 10px;
      opacity: 0.8;
      margin-top: 2px;
    }

    /* Progress */
    .progress-section {
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .progress-bar-container {
      background: var(--border);
      height: 8px;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent) 0%, #15803d 100%);
      transition: width 0.3s ease;
      border-radius: 8px;
    }

    .progress-text {
      font-size: 12px;
      color: var(--muted);
      text-align: center;
    }

    .footer {
      text-align: center;
      color: var(--muted);
      font-size: 12px;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .rest-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(8px);
    }

    .rest-overlay.active {
      display: flex;
    }

    .rest-content {
      text-align: center;
      color: white;
    }

    .rest-time {
      font-size: 80px;
      font-weight: 800;
      margin-bottom: 20px;
      font-variant-numeric: tabular-nums;
    }

    .rest-message {
      font-size: 20px;
      margin-bottom: 30px;
      opacity: 0.9;
    }

    @media (max-width: 600px) {
      .timer-display { font-size: 40px; }
      .rest-time { font-size: 60px; }
      .series-tracker { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">üí™ GYM TRACKER PRO</div>
      <div class="subtitle">Rutina de hipertrofia para ectomorfos | 4 series progresivas</div>
    </div>

    <!-- Navegaci√≥n de d√≠as -->
    <div class="card">
      <div class="day-nav" id="dayNav"></div>
    </div>

    <!-- Cron√≥metro -->
    <div class="card">
      <div class="timer-section">
        <div class="timer-label">‚è±Ô∏è Cron√≥metro de descanso</div>
        <div class="timer-display" id="timerDisplay">00:00</div>
        <div class="timer-controls">
          <button class="btn primary" onclick="startTimer(60)">1 min</button>
          <button class="btn primary" onclick="startTimer(90)">1:30 min</button>
          <button class="btn primary" onclick="startTimer(120)">2 min</button>
          <button class="btn danger" onclick="stopTimer()">‚èπ Parar</button>
        </div>
      </div>
    </div>

    <!-- Rutina del d√≠a -->
    <div id="workoutContent"></div>

    <!-- Progress general -->
    <div class="card">
      <div class="progress-section">
        <div class="progress-bar-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        <div class="progress-text" id="progressText">0% completado hoy</div>
      </div>
    </div>

    <div class="footer">
      üí™ Recuerda: la constancia construye m√∫sculos. ¬°Dale duro! üî•
    </div>
  </div>

  <!-- Overlay de descanso -->
  <div class="rest-overlay" id="restOverlay">
    <div class="rest-content">
      <div class="rest-time" id="restTime">00:00</div>
      <div class="rest-message">‚è∏Ô∏è Descansando...</div>
      <button class="btn danger" onclick="stopTimer()">Terminar descanso</button>
    </div>
  </div>

  <script>
    // Rutina semanal completa
    const ROUTINE = {
      1: { // Lunes - PUSH (Empuje)
        name: 'PUSH - Pecho, Hombros, Tr√≠ceps',
        groups: [
          {
            name: 'Pecho',
            icon: 'ü¶æ',
            exercises: [
              { name: 'Press banca con barra', note: 'Agarre medio, baja controlado hasta el pecho' },
              { name: 'Press inclinado con mancuernas', note: 'Banco a 30-45¬∞, aprieta al subir' },
              { name: 'Aperturas en polea (cable cross)', note: 'Brazos ligeramente flexionados, contrae pecho' },
              { name: 'Fondos en paralelas', note: 'Incl√≠nate hacia adelante para activar pecho' }
            ]
          },
          {
            name: 'Hombros',
            icon: 'üèîÔ∏è',
            exercises: [
              { name: 'Press militar con mancuernas', note: 'Sentado, espalda recta, sube vertical' },
              { name: 'Elevaciones laterales con mancuernas', note: 'Codos ligeramente flexionados, sube hasta hombros' },
              { name: 'Elevaciones frontales en polea', note: 'Agarre bajo, alterna brazos o ambos' }
            ]
          },
          {
            name: 'Tr√≠ceps',
            icon: 'üí™',
            exercises: [
              { name: 'Press franc√©s con barra Z', note: 'Acostado, baja hacia frente, codos fijos' },
              { name: 'Extensiones en polea alta (cuerda)', note: 'Separa la cuerda al final del movimiento' },
              { name: 'Fondos en banco', note: 'Pies elevados, baja controlado' }
            ]
          }
        ]
      },
      2: { // Martes - PULL (Tracci√≥n)
        name: 'PULL - Espalda, B√≠ceps, Abdomen',
        groups: [
          {
            name: 'Espalda',
            icon: 'ü¶Ö',
            exercises: [
              { name: 'Jal√≥n al pecho en polea', note: 'Agarre ancho, lleva barra al pecho alto' },
              { name: 'Remo con barra (Pendlay row)', note: 'Torso paralelo, tira hacia abdomen bajo' },
              { name: 'Remo en polea baja', note: 'Espalda recta, aprieta om√≥platos al final' },
              { name: 'Pullover con mancuerna', note: 'Acostado, brazos semi-extendidos' }
            ]
          },
          {
            name: 'B√≠ceps',
            icon: 'üí™',
            exercises: [
              { name: 'Curl con barra Z', note: 'Codos pegados, contrae en la subida' },
              { name: 'Curl martillo con mancuernas', note: 'Agarre neutro, alterna o simult√°neo' },
              { name: 'Curl concentrado', note: 'Sentado, codo apoyado en muslo interno' }
            ]
          },
          {
            name: 'Abdomen',
            icon: 'üî•',
            exercises: [
              { name: 'Crunch en polea alta', note: 'Arrodillado, flexiona tronco con control' },
              { name: 'Elevaci√≥n de piernas colgado', note: 'Barra fija, sube rodillas al pecho' },
              { name: 'Plancha abdominal', note: '3 series de 45-60 seg' }
            ]
          }
        ]
      },
      3: { // Mi√©rcoles - LEGS (Piernas + accesorios)
        name: 'LEGS - Piernas, Hombros, Core',
        groups: [
          {
            name: 'Piernas',
            icon: 'ü¶µ',
            exercises: [
              { name: 'Prensa de piernas', note: 'Pies ancho hombros, baja hasta 90¬∞' },
              { name: 'Extensiones de cu√°driceps', note: 'Sentado, extiende completo y aprieta' },
              { name: 'Curl femoral acostado', note: 'Boca abajo, talones hacia gl√∫teos' },
              { name: 'Elevaci√≥n de gemelos en prensa', note: 'Puntas de pies en borde, rango completo' }
            ]
          },
          {
            name: 'Hombros (posterior)',
            icon: 'üèîÔ∏è',
            exercises: [
              { name: 'P√°jaros con mancuernas', note: 'Inclinado, codos atr√°s, aprieta om√≥platos' },
              { name: 'Face pulls en polea', note: 'Tira hacia cara, codos altos' }
            ]
          },
          {
            name: 'Abdomen',
            icon: 'üî•',
            exercises: [
              { name: 'Abdominales en banco declinado', note: 'Manos en pecho o cabeza' },
              { name: 'Giros rusos con disco', note: 'Sentado, torso inclinado, rota' }
            ]
          }
        ]
      },
      4: { // Jueves - PUSH variado
        name: 'PUSH 2 - Pecho, Tr√≠ceps, Hombros',
        groups: [
          {
            name: 'Pecho',
            icon: 'ü¶æ',
            exercises: [
              { name: 'Press banca con mancuernas', note: 'Mayor rango de movimiento que barra' },
              { name: 'Press declinado con barra', note: 'Banco a -30¬∞, enfoca pecho inferior' },
              { name: 'Peck deck (mariposa)', note: 'M√°quina contractora, aprieta 1 seg' },
              { name: 'Flexiones con lastre', note: 'Chaleco o disco en espalda' }
            ]
          },
          {
            name: 'Tr√≠ceps',
            icon: 'üí™',
            exercises: [
              { name: 'Press cerrado en banca', note: 'Manos juntas, codos cerca del cuerpo' },
              { name: 'Extensiones sobre cabeza con mancuerna', note: 'De pie o sentado, codos arriba' },
              { name: 'Patada de tr√≠ceps con mancuerna', note: 'Inclinado, extiende hacia atr√°s' }
            ]
          },
          {
            name: 'Hombros (lateral)',
            icon: 'üèîÔ∏è',
            exercises: [
              { name: 'Elevaciones laterales en polea', note: 'Unilateral, cruza por delante' },
              { name: 'Press Arnold', note: 'Rota palmas mientras subes' }
            ]
          }
        ]
      },
      5: { // Viernes - PULL 2
        name: 'PULL 2 - Espalda, B√≠ceps, Abdomen',
        groups: [
          {
            name: 'Espalda',
            icon: 'ü¶Ö',
            exercises: [
              { name: 'Dominadas con agarre ancho', note: 'Si no puedes, usa m√°quina asistida' },
              { name: 'Remo con mancuernas (unilateral)', note: 'Rodilla en banco, tira hacia cadera' },
              { name: 'Jal√≥n con agarre cerrado', note: 'Agarre estrecho, activa dorsales bajos' },
              { name: 'Encogimientos con mancuernas', note: 'Trapecios, sube hombros vertical' }
            ]
          },
          {
            name: 'B√≠ceps',
            icon: 'üí™',
            exercises: [
              { name: 'Curl en polea baja', note: 'Cuerda o barra, tensi√≥n constante' },
              { name: 'Curl en banco inclinado', note: 'Banco a 45¬∞, brazos cuelgan atr√°s' },
              { name: 'Curl 21s', note: '7 abajo-medio, 7 medio-arriba, 7 completas' }
            ]
          },
          {
            name: 'Abdomen',
            icon: 'üî•',
            exercises: [
              { name: 'Rueda abdominal', note: 'De rodillas, extiende y regresa' },
              { name: 'Bicicleta abdominal', note: 'Acostado, codo a rodilla opuesta' },
              { name: 'Plancha lateral', note: '3 series de 30-45 seg por lado' }
            ]
          }
        ]
      },
      6: { // S√°bado - FULLBODY
        name: 'FULLBODY - Piernas, Pecho, Espalda',
        groups: [
          {
            name: 'Piernas',
            icon: 'ü¶µ',
            exercises: [
              { name: 'Prensa inclinada', note: 'Variante de prensa, pies m√°s altos' },
              { name: 'Zancadas con mancuernas', note: 'Est√°ticas o caminando' },
              { name: 'Curl femoral sentado', note: 'Variante sentado, mayor aislamiento' },
              { name: 'Elevaci√≥n de gemelos de pie', note: 'M√°quina espec√≠fica o Smith' }
            ]
          },
          {
            name: 'Pecho',
            icon: 'ü¶æ',
            exercises: [
              { name: 'Press en m√°quina (Hammer)', note: 'Agarre neutro, empuje unilateral o bilateral' },
              { name: 'Cruces con mancuernas', note: 'Banco plano, brazos abiertos' }
            ]
          },
          {
            name: 'Espalda',
            icon: 'ü¶Ö',
            exercises: [
              { name: 'Jal√≥n con agarre invertido', note: 'Palmas hacia ti, activa b√≠ceps tambi√©n' },
              { name: 'Remo en m√°quina', note: 'Pecho apoyado, tira hacia ti' }
            ]
          }
        ]
      }
    };

    // Estado
    let currentDay = new Date().getDay(); // 0=Domingo, 1=Lunes...
    if (currentDay === 0) currentDay = 1; // Si es domingo, mostrar lunes
    let timerInterval = null;
    let timerSeconds = 0;
    let completedSeries = {};

    // Inicializar
    function init() {
      renderDayNav();
      loadProgress();
      renderWorkout();
    }

    // Renderizar navegaci√≥n de d√≠as
    function renderDayNav() {
      const days = ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
      const nav = document.getElementById('dayNav');
      nav.innerHTML = days.map((day, i) => `
        <button class="day-btn ${currentDay === i + 1 ? 'active' : ''}" onclick="changeDay(${i + 1})">
          ${day}
          <span class="day-name">${ROUTINE[i + 1].name.split(' - ')[0]}</span>
        </button>
      `).join('');
    }

    // Cambiar d√≠a
    function changeDay(day) {
      currentDay = day;
      renderDayNav();
      renderWorkout();
    }

    // Renderizar rutina del d√≠a
    function renderWorkout() {
      const workout = ROUTINE[currentDay];
      const content = document.getElementById('workoutContent');
      
      content.innerHTML = `
        <div class="card">
          <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 20px; text-align: center;">
            ${workout.name}
          </h2>
          <div class="muscle-groups">
            ${workout.groups.map((group, gIdx) => `
              <div class="muscle-group">
                <div class="muscle-group-header">
                  <span class="muscle-icon">${group.icon}</span>
                  <span class="muscle-name">${group.name}</span>
                  <span class="muscle-badge">${group.exercises.length} ejercicios</span>
                </div>
                <div class="exercises">
                  ${group.exercises.map((ex, eIdx) => `
                    <div class="exercise">
                      <div class="exercise-name">${ex.name}</div>
                      <div class="exercise-note">${ex.note}</div>
                      <div class="series-tracker">
                        ${[12, 10, 8, 8].map((reps, sIdx) => {
                          const key = `${currentDay}-${gIdx}-${eIdx}-${sIdx}`;
                          const isDone = completedSeries[key] || false;
                          return `
                            <button class="serie-btn ${isDone ? 'done' : ''}" onclick="toggleSerie('${key}')">
                              <span class="serie-reps">${reps}</span>
                              <span class="serie-label">rep</span>
                            </button>
                          `;
                        }).join('')}
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
      
      updateProgress();
    }

    // Toggle serie completada
    function toggleSerie(key) {
      completedSeries[key] = !completedSeries[key];
      saveProgress();
      renderWorkout();
      
      // Auto-iniciar timer si se completa una serie
      if (completedSeries[key]) {
        startTimer(90); // 1:30 por defecto
      }
    }

    // Cron√≥metro
    function startTimer(seconds) {
      stopTimer();
      timerSeconds = seconds;
      updateTimerDisplay();
      document.getElementById('restOverlay').classList.add('active');
      
      timerInterval = setInterval(() => {
        timerSeconds--;
        updateTimerDisplay();
        
        if (timerSeconds <= 0) {
          stopTimer();
          // Vibraci√≥n si est√° disponible
          if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
        }
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      document.getElementById('restOverlay').classList.remove('active');
      timerSeconds = 0;
      updateTimerDisplay();
    }

    function updateTimerDisplay() {
      const mins = Math.floor(timerSeconds / 60);
      const secs = timerSeconds % 60;
      const timeStr = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      document.getElementById('timerDisplay').textContent = timeStr;
      document.getElementById('restTime').textContent = timeStr;
    }

    // Progreso
    function updateProgress() {
      const workout = ROUTINE[currentDay];
      const totalSeries = workout.groups.reduce((sum, g) => sum + g.exercises.length * 4, 0);
      const completed = Object.keys(completedSeries).filter(k => {
        return k.startsWith(`${currentDay}-`) && completedSeries[k];
      }).length;
      
      const percent = Math.round((completed / totalSeries) * 100);
      document.getElementById('progressBar').style.width = percent + '%';
      document.getElementById('progressText').textContent = `${percent}% completado hoy (${completed}/${totalSeries} series)`;
    }

    // Persistencia
    function saveProgress() {
      localStorage.setItem('gymProgress', JSON.stringify(completedSeries));
    }

    function loadProgress() {
      const saved = localStorage.getItem('gymProgress');
      if (saved) {
        completedSeries = JSON.parse(saved);
      }
    }

    // Reset diario autom√°tico
    function checkDailyReset() {
      const lastDate = localStorage.getItem('lastGymDate');
      const today = new Date().toDateString();
      
      if (lastDate !== today) {
        // Limpiar progreso del d√≠a anterior
        const keys = Object.keys(completedSeries);
        keys.forEach(k => {
          if (k.startsWith(`${currentDay}-`)) {
            delete completedSeries[k];
          }
        });
        saveProgress();
        localStorage.setItem('lastGymDate', today);
      }
    }

    // Init
    checkDailyReset();
    init();
  </script>
</body>
</html>

